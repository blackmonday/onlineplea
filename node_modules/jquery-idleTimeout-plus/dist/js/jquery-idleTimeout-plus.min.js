!function(t,o){"function"==typeof define&&define.amd?define(["jquery"],o):"object"==typeof exports?module.exports=o(require("jquery")):t.IdleTimeoutPlus=o(t.jQuery)}(this,function(t){function o(){null==R&&(R=$.localStorage?$.initNamespaceStorage("jqueryIdleTimeoutPlus").localStorage:{})}function n(t,o){z.multiWindowSupport?R.set(t,o):R[t]=o}function e(t,o){if(o="undefined"!=typeof o?o:null,z.multiWindowSupport){if(R.isSet(t))return R.get(t)}else if(t in R)return R[t];return o}function l(){n("warningStartTime",-1),n("lockStartTime",-1),i(),z.idleCallback!==!1&&z.idleCallback(z)}function i(){a(),n("lastActivity",$.now()),Z=setInterval(r,z.idleCheckHeartbeat)}function a(){clearInterval(Z)}function r(){var t=e("lastActivity",$.now())+z.idleTimeLimit;return e("logoutTriggered")===!0?N():-1!=e("lockStartTime",-1)?(a(),U()):$.now()>=t?(a(),z.warnEnabled?d():z.lockEnabled?A():O()):void 0}function c(){$(document).on(z.activityEvents,function(t){if("mousemove"===t.type){if(t.clientX===nt[0]&&t.clientY===nt[1])return;nt[0]=t.clientX,nt[1]=t.clientY}-1==e("warningStartTime",-1)&&-1==e("lockStartTime",-1)&&i()})}function u(){s(),_=setInterval(function(){$.ajax({type:z.keepAliveAjaxType,url:z.keepAliveUrl,data:z.keepAliveAjaxData})},z.keepAliveInterval)}function s(){clearInterval(_)}function d(){k(),z.warnCallback!==!1&&(et=z.warnCallback(z)),w()}function p(){f(),b(),n("warningStartTime",-1),l()}function k(){n("warningStartTime",$.now()),tt=setInterval(v,500)}function f(){clearInterval(tt)}function v(){if(e("logoutTriggered")===!0)return f(),N();if(-1==e("warningStartTime",-1))return p();var t=e("warningStartTime")+z.warnTimeLimit-1;return $.now()>=t?(f(),z.lockEnabled?(b(),A()):O()):void m()}function w(){et&&(g(),m(),z.bootstrap?it.modal("show"):it.dialog("open"),lt=!0)}function b(){lt=!1,null!==it&&(z.bootstrap?(it.modal("hide"),F.removeClass("modal-open"),$("div.modal-backdrop").remove()):it.dialog("close"))}function m(){if(null!==it&&(null!==at||null!==rt)){var t=$.now(),o=Math.floor((e("warningStartTime",t)+z.warnTimeLimit-t)/1e3);if(null!==at&&at.html(G(o)),null!=rt){var n=Math.floor(o/(z.warnTimeLimit/1e3)*100);z.bootstrap?rt.css("width",n+"%"):rt.progressbar("value",n)}}}function g(){if(null===it){var t="";t=z.warnContentCallback!==!1?z.warnContentCallback(z):z.bootstrap?C():h(),z.bootstrap?j(t):y(t)}}function j(t){F.append(t),$("#jitp-warn-logout").on("click",function(){T()}),$("#jitp-warn-alive").on("click",function(){S()}),it=$("#jitp-warn-display"),(null!=z.warnCountdownMessage||z.warnCountdownBar)&&(at=it.find(".jitp-countdown-holder")),z.warnCountdownBar&&(rt=$("#jitp-warn-bar"))}function y(t){$(t).dialog({buttons:[{text:z.warnLogoutButton,click:function(){T()}},{text:z.warnStayAliveButton,click:function(){S()}}],closeOnEscape:!1,modal:!0,title:z.warnTitle,minWidth:320,autoOpen:!1,open:function(){null==z.warnTitle?$(this).closest(".ui-dialog").find(".ui-dialog-titlebar").hide():$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide(),$(this).parent().find("button:nth-child(2)").focus()}}),it=$("#jitp-warn-display"),null!=z.warnCountdownMessage&&(at=it.find(".jitp-countdown-holder")),z.warnCountdownBar&&(rt=$("#jitp-warn-bar"),rt.progressbar({value:0,max:100}))}function C(){var t=z.warnTitle?'<div class="modal-header"><h4 class="modal-title">'+z.warnTitle+"</h4></div>":"",o=null!=z.warnCountdownMessage?"<p>"+z.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",n=z.warnCountdownBar?'<div class="progress">               <div id="jitp-warn-bar" class="progress-bar progress-bar-striped active" role="progressbar" style="min-width: 15px; width: 100%;">                 <span class="jitp-countdown-holder"></span>               </div>             </div>':"";return'<div class="modal fade" id="jitp-warn-display" data-backdrop="static" data-keyboard="false">                 <div class="modal-dialog">                     <div class="modal-content">                          '+t+'                         <div class="modal-body">                             <p>'+z.warnMessage+"</p>                             "+o+"                             "+n+'                         </div>                         <div class="modal-footer">                             <button id="jitp-warn-logout" type="button" class="btn btn-default">'+z.warnLogoutButton+'</button>                             <button id="jitp-warn-alive" type="button" class="btn btn-primary">'+z.warnStayAliveButton+"</button>                         </div>                     </div>                 </div>             </div>"}function h(){var t=null!=z.warnCountdownMessage?"<p>"+z.warnCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</p>":"",o=z.warnCountdownBar?'<div id="jitp-warn-bar"></div>':"";return'<div id="jitp-warn-display"><p>'+z.warnMessage+"</p>"+t+o+"</div>"}function T(){f(),D()}function S(){p()}function A(){z.lockHaltKeepAlive&&s(),M(),z.lockCallback!==!1&&(ct=z.lockCallback(z)),x()}function U(){z.lockHaltKeepAlive?s():z.keepAliveInterval&&u(),-1==e("lockStartTime",-1)?M():ot=setInterval(B,500),x()}function L(){I(),E(),$("#jitp-lock-pass").val(""),z.keepAliveInterval&&u(),n("lockStartTime",-1),l()}function M(){n("lockStartTime",$.now()),ot=setInterval(B,500)}function I(){clearInterval(ot)}function B(){if(1==e("logoutTriggered"))return I(),N();if(-1==e("lockStartTime",-1))return L();var t=e("lockStartTime")+z.lockTimeLimit-1;return $.now()>=t?(I(),1==e("logoutTriggered")?N():O()):void q()}function x(){if(ct){P(),q();var t={message:$("#jitp-lock-display")};t=$.extend(t,z.lockBlockUiConfig),$.blockUI(t),ut=!0}}function E(){$.unblockUI(),ut=!1}function q(){if(null!==dt){var t=$.now(),o=Math.floor((e("lockStartTime",t)+z.lockTimeLimit-t)/1e3);dt.html(G(o))}}function P(){if(null===st){var t="";t=z.lockContentCallback!==!1?z.lockContentCallback(z):z.bootstrap?W():H(),F.append(t),st=$("#jitp-lock-display"),0!=z.lockCountdownMessage&&(dt=st.find(".jitp-countdown-holder")),$("#jitp-lock-logout").on("click",function(){Q()}),$("#jitp-lock-unlock").on("click",function(){K()}),$("#jitp-lock-form").length&&$("#jitp-lock-form").submit(function(){return K(),!1}),q()}}function W(){var t=null!==z.lockTitle?'<div class="panel-heading"><h2 class="panel-title">'+z.lockTitle+"</h2></div>":"",o=z.lockLogoutButton.replace(/{username}/g,z.lockUsername),n=z.lockCountdownMessage?'<div class="panel-footer">'+z.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</div>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="panel panel-default jitp-lock-panel">                 '+t+'                 <div class="panel-body">                     <h4>'+z.lockUsername+"</h4>                     <p>"+z.lockMessage+'</p>                     <div class="input-group">                         <input id="jitp-lock-pass" type="password" class="form-control" placeholder="Password..."/>                         <span class="input-group-btn">                             <button id="jitp-lock-unlock" class="btn btn-primary" type="button">'+z.lockUnlockButton+'</button>                         </span>                     </div>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function H(){var t=null!==z.lockTitle?"<header>"+z.lockTitle+"</header>":"",o=z.lockLogoutButton.replace(/{username}/g,z.lockUsername),n=z.lockCountdownMessage?"<footer>"+z.lockCountdownMessage.replace(/{timer}/g,'<span class="jitp-countdown-holder"></span>')+"</footer>":"";return'<div id="jitp-lock-display" class="jitp-lock-back" style="display: none;">             <div class="jitp-lock-panel jitp-lock-jqpanel">                 '+t+'                 <div class="jitp-lock-jqpanel-body">                     <h2>'+z.lockUsername+"</h2>                     <p>"+z.lockMessage+'</p>                     <div>                         <input id="jitp-lock-pass" type="text" class="form-control" placeholder="Password..."/>                     </div>                     <button id="jitp-lock-unlock" type="button">'+z.lockUnlockButton+'</button>                     <a id="jitp-lock-logout" href="javascript:;">'+o+"</a>                 </div>                 "+n+"            </div>            </div>"}function Q(){I(),D()}function K(){z.lockPassCallback($("#jitp-lock-pass").val())}function Y(){s(),a(),f(),I()}function D(){Y(),n("logoutTriggered",!0),("function"!=typeof z.logoutCallback||z.logoutCallback(z))&&window.location.replace(z.logoutUrl)}function N(){Y(),("function"!=typeof z.logoutAutoCallback||z.logoutAutoCallback(z))&&window.location.replace(z.logoutAutoUrl)}function O(){return Y(),z.multiWindowSupport?void setTimeout(X,J(100,500)):X()}function X(){return e("logoutTriggered",!1)?N():(n("logoutTriggered",!0),void(("function"!=typeof z.redirectCallback||z.redirectCallback(z))&&window.location.replace(z.redirectUrl)))}function G(t){var o=Math.floor(t/60);if(15>=o){var n=t%60,e=o>0?o+"m ":"";return e+=n+"s"}if(75>=o)return 22>=o?"about 15 mins":37>=o?"about 30 mins":52>=o?"about 25 mins":"about 1 hour";var l=Math.floor(o/60);return o%=60,15>=o?"about "+l+" hours":o>52?"about "+(l+1)+" hours":"about "+l+"&frac12; hours"}function J(t,o){return Math.floor(Math.random()*(o-t))+t}var z={idleTimeLimit:1200,idleCallback:!1,idleCheckHeartbeat:2,activityEvents:"click keypress scroll wheel mousewheel mousemove touchmove",bootstrap:!1,warnEnabled:!0,warnTimeLimit:180,warnCallback:!1,warnContentCallback:!1,warnTitle:"Session Timeout",warnMessage:"Your session is about to expire!",warnStayAliveButton:"Stay Connected",warnLogoutButton:"Logout",warnCountdownMessage:"Time remaining: {timer}",warnCountdownBar:!1,redirectUrl:"/timed-out",logoutUrl:"/logout",logoutAutoUrl:"null",redirectCallback:!1,logoutCallback:!1,logoutAutoCallback:!1,keepAliveInterval:600,keepAliveUrl:window.location.href,keepAliveAjaxType:"GET",keepAliveAjaxData:"",lockEnabled:!1,lockTimeLimit:7200,lockHaltKeepAlive:!0,lockCallback:!1,lockContentCallback:!1,lockPassCallback:!1,lockTitle:null,lockUsername:"System User",lockMessage:"Enter your password to unlock the screen",lockUnlockButton:"UnLock",lockLogoutButton:"Not {username} ?",lockCountdownMessage:"Auto-logout in: {timer}",lockBlockUiConfig:{},lockLoadActive:!1,multiWindowSupport:!1},F=$("body"),R=null,V={};V.start=function(t){if(z=$.extend(z,t),null==z.logoutAutoUrl&&(z.logoutAutoUrl=z.logoutUrl),z.idleTimeLimit*=1e3,z.idleCheckHeartbeat*=1e3,z.warnTimeLimit*=1e3,z.lockTimeLimit*=1e3,z.keepAliveInterval*=1e3,z.multiWindowSupport&&!$.localStorage)return console.error("jitp: Multi-Window support requested but JQuery Storage API is unavailable."),!1;if(z.warnEnabled&&z.warnCallback===!1||z.lockEnabled&&z.lockCallback===!1)if(z.bootstrap){if("undefined"==typeof $.fn.modal)return console.error("jitp: Bootstrap library is unavailable"),!1}else if("undefined"==typeof jQuery.ui)return console.error("jitp: jQueryUI library is unavailable"),!1;if(z.lockEnabled&&!z.multiWindowSupport)return console.error("jitp: Lock screen requested but multi-window support is not enabled."),!1;if(z.lockEnabled&&z.lockCallback===!1){if("undefined"==typeof $.blockUI)return console.error("jitp: Lock screen requested but blockUI library is unavailable."),!1;if(z.lockPassCallback===!1)return console.error("jitp: Lock screen requested but lockPassCallback function is not set."),!1}return o(),z.lockEnabled&&(z.lockLoadActive||e("lockStartTime",-1)>0)?U():(n("logoutTriggered",!1),n("warningStartTime",-1),n("lockStartTime",-1),n("lastActivity",$.now()),i(),z.keepAliveInterval&&u()),z.keepAliveInterval&&u(),c(),!0},V.cleanUpLockScreen=function(){o(),$.localStorage&&R.set("lockStartTime",-99)},V.logout=function(){D()},V.displayWarning=function(){w()},V.displayLockScreen=function(){x()},V.initLockScreen=function(){a(),f(),A()},V.rollback=function(){L(),p()};var Z,_,tt,ot,nt=[-1,-1],et=!0,lt=!1,it=null,at=null,rt=null,ct=!0,ut=!1,st=null,dt=null;return V});